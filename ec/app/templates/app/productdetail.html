{% extends 'app/base.html' %}
{% load static %}
{% block title %}Detalle del Producto{% endblock title %}

{% block main-content %}
<div class="container my-5">
    <div class="row g-4 align-items-center">
        <!-- Imagen del producto -->
        <div class="col-lg-5 text-center">
            <img src="{{ product.imagen_producto.url }}" 
                 class="img-fluid rounded shadow" 
                 alt="{{ product.title }}">
        </div>

        <!--  Detalles del producto -->
        <div class="col-lg-7">
            <h2 class="fw-bold mb-3">{{ product.title }}</h2>
            
            <!-- Precios -->
            <div class="mb-3">
                <span class="fs-4 fw-bold text-danger">
                    USD {{ product.precio_descuento }}
                </span>
                {% if product.selling_price > product.precio_descuento %}
                <span class=" text-decoration-line-through fs-5 ms-2">
                    USD {{ product.selling_price }}
                </span>
                {% endif %}
            </div>

            <!-- Descripción -->
            <h5 class="mb-2">Características del producto</h5>
            <p class="fs-6 text-secondary">{{ product.description }}</p>

            <!-- Botones de acción -->
            <div class="product-actions mt-4">
                <form action="/add-to-cart/"class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="prod_id" value="{{ product.id }}">
                    <button type="submit" class="btn btn-primary shadow px-4 py-2">
                        Añadir al carrito
                    </button>
                </form>

                <a href="{% url 'checkout' %}?prod_id={{ product.id }}" 
                class="btn btn-warning shadow px-4 py-2">
                Comprar Ahora
                </a>

                {% if wishlist %}
                <a pid="{{ product.id }}" class="minus-wishlist btn btn-danger shadow px-3 py-2">
                    <i class="fas fa-heart fa-lg"></i>
                </a>
                {% else %}
                <a pid="{{ product.id }}" class="plus-wishlist btn btn-success shadow px-3 py-2">
                    <i class="fas fa-heart fa-lg"></i>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function(){
    $('.plus-wishlist').click(function(e){
        e.preventDefault();
        var id = $(this).attr("pid").toString();
        $.ajax({
            type: "GET",
            url: "{% url 'pluswishlist' %}",
            data: { prod_id: id },
            success: function(data){
                console.log(data.message);
                window.location.reload();
            },
            error: function(){
                alert("Error al agregar a la lista de deseos");
            }
        });
    });

    $('.minus-wishlist').click(function(e){
        e.preventDefault();
        var id = $(this).attr("pid").toString();
        $.ajax({
            type: "GET",
            url: "{% url 'minuswishlist' %}",
            data: { prod_id: id },
            success: function(data){
                console.log(data.message);
                window.location.reload();
            },
            error: function(){
                alert("Error al eliminar de la lista de deseos");
            }
        });
    });

});
</script>
{% endblock main-content %}