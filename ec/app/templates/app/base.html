<!DOCTYPE html>
{% load static %}
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ===== Dependencias CSS/JS ===== -->
  <!-- (Opcional) Tailwind (si lo usas en otras plantillas). Si te da problemas, coméntalo/remuévelo. -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Bootstrap 5 (CSS) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />

  <title>{% block title %}Mi Ecommerce{% endblock title %}</title>

  <!-- ===== Estilos específicos del layout ===== -->
  <style>
    /* ===== Contenedor header ===== */
    header.site-header {
      background: linear-gradient(90deg, #1A1A2E, #16213E);
      color: #fff;
      min-height: 64px;
    }

    /* Logo (siempre alineado a la izquierda y con altura fija) */
    .site-logo img {
      height: 48px;
      width: auto;
      display: block;
    }

    /* Forzamos que el contenedor del header centre verticalmente */
    .header-inner {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    /* Links del header */
    .site-nav a {
      color: #fff;
      text-decoration: none;
      padding: 0.35rem 0.6rem;
      display:inline-block;
    }
    .site-nav a:hover { color: #E94560; text-decoration:none; }

    /* Botón acento (reutilizable) */
    .btn-acento {
      background-color: #E94560;
      color: #fff;
      border-radius: 8px;
      transition: background-color .2s ease;
    }
    .btn-acento:hover { background-color: #C81E45; color: #fff; }

    /* Dropdown del usuario como overlay absoluto */
    .nav-user {
      position: relative; 
    }
    .nav-user .dropdown-menu {
      position: absolute;
      top: calc(100% + 6px);
      right: 0;
      z-index: 3000;
      min-width: 10rem;
    }

    /* Offcanvas ancho en móvil */
    .offcanvas-start { width: 80% !important; max-width: 420px; }

    /* Footer */
    footer.site-footer {
      background: linear-gradient(90deg, #16213E, #1A1A2E);
      color: #F1F1F1;
    }

    /* Ajustes responsivos */
    @media (max-width: 768px) {
      .site-nav { display: none; } 
    }
  </style>
</head>

<body class="bg-light d-flex flex-column min-vh-100">

  <!-- ===== HEADER ===== -->
  <header class="site-header shadow">
    <div class="container header-inner py-2">
      <!-- Logo -->
      <div class="site-logo me-3">
        <a href="{% url 'home' %}">
          <img src="{% static 'app/images/logo.png' %}" alt="Logo">
        </a>
      </div>

      <!-- Navegación principal (visible en escritorio) -->
      <nav class="site-nav ms-2 me-auto d-none d-md-flex align-items-center">
        <a href="{% url 'home' %}" class="me-2">Inicio</a>
        <a href="{% url 'about' %}" class="me-2">Sobre nosotros</a>
        <a href="{% url 'contact' %}" class="me-2">Contacto</a>
      </nav>

      <!-- Buscador (escritorio) -->
      <form class="d-none d-md-flex align-items-center me-3" role="search" action="/search">
        <input name="search" class="form-control form-control-sm" type="search" placeholder="Buscar..." aria-label="Buscar">
        <button class="btn btn-acento btn-sm ms-2" type="submit">Buscar</button>
      </form>

      <!-- Botón modo oscuro -->
      <button id="darkModeToggle" class="btn btn-sm btn-outline-light me-3" title="Modo oscuro">
        <i class="fas fa-moon"></i>
      </button>

      <!-- Usuario / Carrito / Wishlist -->
      <div class="d-flex align-items-center gap-3">
        {% if request.user.is_authenticated %}
          <!-- Dropdown de usuario -->
          <div class="nav-user dropdown">
            <button class="btn btn-sm dropdown-toggle text-white bg-transparent border-0" id="userMenuBtn" data-bs-toggle="dropdown" aria-expanded="false">
              {{ request.user.username }}
            </button>

            <!-- Menú absoluto (overlay) -->
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenuBtn">
              <li><a class="dropdown-item" href="{% url 'address' %}">Perfil</a></li>
              <li><a href="{% url 'orders' %}" class="dropdown-item">Ver  Pedidos</a></li>
              <li><a class="dropdown-item" href="{% url 'passwordchange' %}">Cambiar contraseña</a></li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <!-- Logout -->
                <form method="post" action="{% url 'logout' %}" class="m-0">
                  {% csrf_token %}
                  <button type="submit" class="dropdown-item">Salir</button>
                </form>
              </li>
            </ul>
          </div>

          <!-- Carrito -->
          <a href="{% url 'showcart' %}" class="text-white position-relative" title="Carrito">
            <i class="fa fa-shopping-cart fa-lg"></i>
            {% if totalitem and totalitem > 0 %}
              <span class="badge bg-danger rounded-circle position-absolute" style="top:-6px; right:-8px; font-size:.65rem;">
                {{ totalitem }}
              </span>
            {% endif %}
          </a>

          <!-- Wishlist -->
          <a href="{% url 'showwishlist' %}" class="text-white ms-2 position-relative ms-2" title="Wishlist">
            <i class="fa fa-heart fa-lg"></i>
            {% if wishitem and wishitem > 0 %}
              <span class="badge bg-danger rounded-circle position-absolute" style="top:-6px; right:-8px; font-size:.65rem;">
                {{ wishitem }}
              </span>
            {% endif %}
          </a>

        {% else %}
          <!-- Acceso -->
          <a href="{% url 'login' %}" class="text-white">Acceso</a>
          <a href="{% url 'customerregistration' %}" class="text-white ms-2">Registro</a>
        {% endif %}
      </div>

      <!-- Botón hamburguesa (móvil) -->
      <button class="btn btn-sm btn-light d-md-none ms-3" type="button" data-bs-toggle="offcanvas" data-bs-target="#menuLateral">
        <i class="fa fa-bars"></i>
      </button>
    </div>
  </header>

  <!-- ===== OFFCANVAS (móvil) ===== -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="menuLateral" aria-labelledby="menuLateralLabel">
    <div class="offcanvas-header">
      <h5 id="menuLateralLabel" class="offcanvas-title">Menú</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
    </div>
    <div class="offcanvas-body">
      <nav class="mb-3">
        <a class="d-block py-2" href="{% url 'home' %}">Inicio</a>
        <a class="d-block py-2" href="{% url 'about' %}">Sobre nosotros</a>
        <a class="d-block py-2" href="{% url 'contact' %}">Contacto</a>
      </nav>

      <form role="search" action="/search" class="d-flex mb-3">
        <input name="search" class="form-control form-control-sm" type="search" placeholder="Buscar...">
        <button class="btn btn-acento btn-sm ms-2" type="submit">Buscar</button>
      </form>

      {% if request.user.is_authenticated %}
        <div class="border-top pt-3">
          <p class="mb-1"><strong>{{ request.user.username }}</strong></p>
          <a class="d-block py-1" href="{% url 'address' %}">Perfil</a>
          <a class="d-block py-1" href="{% url 'passwordchange' %}">Cambiar contraseña</a>
          <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger btn-sm mt-2 w-100">Salir</button>
          </form>
        </div>
      {% else %}
        <div class="border-top pt-3">
          <a class="d-block py-1" href="{% url 'login' %}">Acceso</a>
          <a class="d-block py-1" href="{% url 'customerregistration' %}">Registro</a>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- ===== CONTENIDO PRINCIPAL ===== -->
  <main class="container my-4 flex-grow" id="main-container">
    {% block banner-slider %}{% endblock %}
    {% block information %}{% endblock %}
    {% block main-content %}{% endblock %}
    {% block payment-gateway %}{% endblock %}
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="site-footer text-center py-3 mt-auto">
    <div class="container">
      <p class="mb-0">© 2025 Minino Tecs - Ecommerce</p>
    </div>
  </footer>

  <!-- ===== SCRIPTS ===== -->
  <!-- Bootstrap JS bundle  -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ===== Modo oscuro extendido  ===== */
(function(){
  const body = document.body;
  const toggleBtn = document.getElementById('darkModeToggle');
  if (!toggleBtn) return; 

  const icon = toggleBtn.querySelector('i');

  function applyDarkMode(isDark){
    // ===== Body =====
    if (isDark) {
      body.classList.add('bg-dark','text-light');
      body.classList.remove('bg-light','text-dark');
    } else {
      body.classList.remove('bg-dark','text-light');
      body.classList.add('bg-light','text-dark');
    }

    // ===== Modales =====
    document.querySelectorAll('.modal-content').forEach(modal => {
      if (isDark) {
        modal.classList.add('bg-dark','text-light');
        modal.classList.remove('bg-white','text-dark');
      } else {
        modal.classList.remove('bg-dark','text-light');
        modal.classList.add('bg-white','text-dark');
      }
    });

    // ===== Dropdowns =====
    // document.querySelectorAll('.dropdown-menu').forEach(menu => {
    //   if (isDark) {
    //     menu.classList.add('bg-dark','text-light');
    //     menu.classList.remove('bg-white','text-dark');
    //   } else {
    //     menu.classList.remove('bg-dark','text-light');
    //     menu.classList.add('bg-white','text-dark');
    //   }
    // });

    // ===== Tarjetas opcionales =====
    // document.querySelectorAll('.card').forEach(card => {
    //   if (isDark) {
    //     card.classList.add('bg-dark','text-light');
    //     card.classList.remove('bg-white','text-dark');
    //   } else {
    //     card.classList.remove('bg-dark','text-light');
    //     card.classList.add('bg-white','text-dark');
    //   }
    // });
  }

  // ===== Inicializar según localStorage =====
  let dark = localStorage.getItem('darkMode') === 'true';
  applyDarkMode(dark);
  icon.classList.toggle('fa-sun', dark);
  icon.classList.toggle('fa-moon', !dark);

  toggleBtn.addEventListener('click', () => {
    dark = !dark;
    applyDarkMode(dark);
    icon.classList.toggle('fa-sun', dark);
    icon.classList.toggle('fa-moon', !dark);
    localStorage.setItem('darkMode', dark);
  });
})();
</script>

</body>
</html>